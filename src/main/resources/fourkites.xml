<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:integration="http://www.springframework.org/schema/integration"
       xmlns:integration-http="http://www.springframework.org/schema/integration/http"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd   http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http.xsd">



    <!-- Http Inbound Component -->
    <!-- To receive messages over HTTP, you need to use an HTTP Inbound Channel Adapter or Gateway -->
    <!-- By default the gateway will simply acknowledge that the request was received by sending a 200 status code back. -->

    <integration-http:inbound-gateway
                                      path="/restfullservices/fourkites"
                                      supported-methods="POST"
                                      request-channel="fourkiteQueueChannel"
                                      request-payload-type="com.transplace.tracking.fourkites.beans.StopUpdate">
        <integration-http:request-mapping consumes="application/json" produces="application/json" />
    </integration-http:inbound-gateway>

    <!-- CHANNEL -->
    <!-- point-to-point semantics -->

    <!-- By default Messages are stored in-memory using org.springframework.integration.store.SimpleMessageStore,
    an implementation of MessageStore. That might be fine for development or simple low-volume environments where
    the potential loss of non-persistent messages is not a concern. -->
    <integration:channel id="fourkiteQueueChannel">
        <!-- Recommend to set capacity and not setup an unbound queue-->
        <integration:queue capacity="100" ></integration:queue>
    </integration:channel>


    <integration:logging-channel-adapter channel="fourkiteQueueChannel" level="INFO"  log-full-message="true"/>


   <integration:service-activator output-channel="outboundTMS"
                                  input-channel="fourkiteQueueChannel"
                                  ref="fourkitesTransformerService" method="transform">
        <!-- Polling task will be invoked 10 times per poll or until it returns null
            thus possibly producing 10 Messages per poll while each poll happens at 1 second intervals. -->
        <integration:poller fixed-rate="1000" max-messages-per-poll="10"/>
    </integration:service-activator>


    <integration:channel id="outboundTMS">
        <!-- Recommend to set capacity and not setup an unbound queue-->
        <integration:queue capacity="100" ></integration:queue>
    </integration:channel>


    <!--
    <integration-http:outbound-gateway request-channel="outboundTMS"
                               url="http://localhost:8080/http/receiveGateway"
                               http-method="POST"
                               expected-response-type="java.lang.String"/> -->


</beans>